#
# Run cppcheck, build everything with debug features enabled, run tests.
# 

dist: trusty
language: cpp  

os:
  - linux
  - osx

compiler:
  - gcc
  - clang

addons:
  apt:
    packages: ['cmake', 'libboost-dev', 'libboost-filesystem-dev', 'clang-3.7', 'gcc-5', 'g++-5', 'x11']
    sources: ['kalakris-cmake', 'llvm-toolchain-precise', 'ubuntu-toolchain-r-test']
    
before_install:
  - if [ $TRAVIS_OS_NAME == linux ]; then echo "linux stuff"; fi
  - if [ $TRAVIS_OS_NAME == osx ]; then echo "osx stuff"; fi

before_script:
  - mkdir -p dist/debug
  - cd dist/debug
  - cmake -DCMAKE_BUILD_TYPE=Release ../..
  - cd ../..

script: 
  - ./cppcheck.sh &> check-results ; if [ -s check-results ]; then (cat check-results ; exit 1); else exit 0; fi
  - cd dist/debug ; make solemnsky_{tests,client,server}
  - ./tests/solemnsky_tests

